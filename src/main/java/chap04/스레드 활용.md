# 스레드 활용

## 스레드 예외처리 - UncaughtExceptionHandler

- 기본적으로 스레드의 run() 은 예외를 던질 수 없기 때문에 예외가 발생할 경우 run() 안에서만 예외를 처리해야 한다
- RuntimeException 타입의 예외가 발생할 지라도 스레드 밖에서 예외를 캐치할 수 없고 사라진다
- 스레드가 비정상적으로 종료되었거나 특정한 예외를 스레드 외부에서 캐치하기 위해서 자바에서는 UncaughtExceptionHandler 인터페이스를 제공한다 

### UncaughtExceptionHandler

- 캐치 되지 않는 예외에 의해 Thread가 갑자기 종료했을 때에 호출되는 핸들러 인터페이스

```java
UncaughtExceptionHandler

void uncaughtException(Thread t, Throwable e)

```
- 예외가 발생하면 uncaughtException 이 호출되고 대상 스레드 t 와 예외 e 가 인자로 전달된다

### Thread API

- static void setDefaultUncaughtExceptionHandler
  - 모든 스레드에서 발생하는 uncaughtException 을 처리하는 정적 메서드

- void setUncaughtExceptionHandler(UncaughtExceptionHandler ueh) 
  - 대상 스레드에서 발생하는 uncaughtException 을 처리하는 인스턴스 메서드
  - setDefaultUncaughtExceptionHandler 보다 우선순위가 높다

<img width="1082" alt="image" src="https://github.com/saechimdaeki/Dev-Diary/assets/40031858/574ee51c-3d8d-4334-b409-51a5fbb22c4e">

---

## 스레드 중지 - flag variable vs interrupt()

- 자바에서는 무한 반복이나 지속적인 실행 중에 있는 스레드를 중지하거나 종료할 수 있는 API 를 더 이상 사용할 수 없다 (suspend(), stop())
- 스레드를 종료하는 방법은 플래그 변수를 사용하거나 interrupt() 를 활용해서 구현할 수 있다

### Flag Variable

- 플래그 변수의 값이 어떤 조건에 만족할 경우 스레드의 실행을 중지하는 방식  
- 플래그 변수는 동시성 문제로 가능한 atomic 변수나 volatile 키워드를 사용하도록 한다

![image](https://github.com/saechimdaeki/Dev-Diary/assets/40031858/c2dd39d7-db67-4b5a-a994-f697261629cc)

### interrupted() & isInterrupted()

- 실행 중인 스레드에 interrupt() 하게 되면 인터럽트 상태를 사용해서 종료기능을 구현할 수 있다
- interrupt() 한다고 해서 스레드가 처리하던 작업이 중지되는 것이 아니며 인터럽트 상태를 활용하여 어떤 형태로든 스레드를 제어할 수 있다

![image](https://github.com/saechimdaeki/Dev-Diary/assets/40031858/c85efe22-9089-4fef-9b26-3f4cf03bd8cb)

### InterruptedException

- 대기 중인 스레드에 interrupt() 하게 되면 InterruptedException 예외가 발생한다. 이 예외 구문에서 종료기능을 구현할 수 있다  

![image](https://github.com/saechimdaeki/Dev-Diary/assets/40031858/b1f191be-a1d6-4d3a-8c7a-92c163b3152c)

